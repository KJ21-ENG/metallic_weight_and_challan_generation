<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Local Print Service Test Client</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .section { margin: 20px 0; padding: 20px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; background: #f8f9fa; border-radius: 3px; }
        .error { background: #f8d7da; color: #721c24; }
        .success { background: #d4edda; color: #155724; }
        input, select { padding: 8px; margin: 5px; border: 1px solid #ddd; border-radius: 3px; width: 200px; }
        label { display: inline-block; width: 120px; }
    </style>
</head>
<body>
    <h1>Local Print Service Test Client</h1>
    
    <div class="section">
        <h2>Service Status</h2>
        <button onclick="checkHealth()">Check Health</button>
        <div id="healthResult" class="result"></div>
    </div>

    <div class="section">
        <h2>Available Printers</h2>
        <button onclick="getPrinters()">List Printers</button>
        <div id="printersResult" class="result"></div>
    </div>

    <div class="section">
        <h2>Test Label Printing</h2>
        <div>
            <label>Printer Name:</label>
            <input type="text" id="labelPrinter" placeholder="Enter printer name" />
        </div>
        <div>
            <label>Header:</label>
            <input type="text" id="labelHeader" value="GLINTEX" />
        </div>
        <div>
            <label>Color:</label>
            <input type="text" id="labelColor" value="Red" />
        </div>
        <div>
            <label>Cut:</label>
            <input type="text" id="labelCut" value="Standard" />
        </div>
        <div>
            <label>Bob Qty:</label>
            <input type="number" id="labelBobQty" value="5" />
        </div>
        <div>
            <label>Gross Weight:</label>
            <input type="number" id="labelGross" value="2.500" step="0.001" />
        </div>
        <div>
            <label>Bob Weight:</label>
            <input type="number" id="labelBobWeight" value="0.250" step="0.001" />
        </div>
        <div>
            <label>Box Weight:</label>
            <input type="number" id="labelBoxWeight" value="0.100" step="0.001" />
        </div>
        <div>
            <label>Operator:</label>
            <input type="text" id="labelOperator" value="John Doe" />
        </div>
        <div>
            <label>Helper:</label>
            <input type="text" id="labelHelper" value="Jane Smith" />
        </div>
        <button onclick="printLabel()">Print Test Label</button>
        <div id="labelResult" class="result"></div>
    </div>

    <div class="section">
        <h2>Test Challan Printing</h2>
        <div>
            <label>Printer Name:</label>
            <input type="text" id="challanPrinter" placeholder="Enter printer name" />
        </div>
        <div>
            <label>Challan No:</label>
            <input type="number" id="challanNo" value="1" />
        </div>
        <div>
            <label>Date:</label>
            <input type="date" id="challanDate" value="2025-01-15" />
        </div>
        <div>
            <label>Customer:</label>
            <input type="text" id="challanCustomer" value="ABC Company" />
        </div>
        <div>
            <label>Items:</label>
            <input type="number" id="challanItems" value="5" />
        </div>
        <div>
            <label>Total Net Weight:</label>
            <input type="number" id="challanWeight" value="10.750" step="0.001" />
        </div>
        <button onclick="printChallan()">Print Test Challan</button>
        <div id="challanResult" class="result"></div>
    </div>

    <script>
        const SERVICE_URL = 'http://localhost:3001';

        async function checkHealth() {
            try {
                const response = await fetch(`${SERVICE_URL}/health`);
                const data = await response.json();
                showResult('healthResult', data, true);
            } catch (error) {
                showResult('healthResult', { error: error.message }, false);
            }
        }

        async function getPrinters() {
            try {
                const response = await fetch(`${SERVICE_URL}/printers`);
                const data = await response.json();
                showResult('printersResult', data, true);
            } catch (error) {
                showResult('printersResult', { error: error.message }, false);
            }
        }

        async function printLabel() {
            const labelData = {
                header: document.getElementById('labelHeader').value,
                dateText: new Date().toLocaleString(),
                color: document.getElementById('labelColor').value,
                cut: document.getElementById('labelCut').value,
                bobQty: parseInt(document.getElementById('labelBobQty').value),
                gross: parseFloat(document.getElementById('labelGross').value),
                bobWeight: parseFloat(document.getElementById('labelBobWeight').value),
                boxWeight: parseFloat(document.getElementById('labelBoxWeight').value),
                net: parseFloat(document.getElementById('labelGross').value) - 
                     (parseInt(document.getElementById('labelBobQty').value) * 
                      parseFloat(document.getElementById('labelBobWeight').value) + 
                      parseFloat(document.getElementById('labelBoxWeight').value)),
                operator: document.getElementById('labelOperator').value,
                helper: document.getElementById('labelHelper').value,
                barcode: 'CH-25-000001-01'
            };

            try {
                const response = await fetch(`${SERVICE_URL}/print/label`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        printerName: document.getElementById('labelPrinter').value,
                        labelData
                    })
                });
                const data = await response.json();
                showResult('labelResult', data, data.success);
            } catch (error) {
                showResult('labelResult', { error: error.message }, false);
            }
        }

        async function printChallan() {
            const challanData = {
                challanId: 123,
                challanNo: parseInt(document.getElementById('challanNo').value),
                date: document.getElementById('challanDate').value,
                customer: document.getElementById('challanCustomer').value,
                items: parseInt(document.getElementById('challanItems').value),
                totalNetWeight: parseFloat(document.getElementById('challanWeight').value)
            };

            try {
                const response = await fetch(`${SERVICE_URL}/print/challan`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        printerName: document.getElementById('challanPrinter').value,
                        challanData
                    })
                });
                const data = await response.json();
                showResult('challanResult', data, data.success);
            } catch (error) {
                showResult('labelResult', { error: error.message }, false);
            }
        }

        function showResult(elementId, data, isSuccess) {
            const element = document.getElementById(elementId);
            element.className = `result ${isSuccess ? 'success' : 'error'}`;
            element.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

        // Auto-check health on page load
        window.onload = function() {
            checkHealth();
        };
    </script>
</body>
</html>
